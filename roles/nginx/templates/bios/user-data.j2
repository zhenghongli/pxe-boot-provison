#cloud-config
autoinstall:
  version: 1
  # use interactive-sections to avoid an automatic reboot
  #interactive-sections:
  #  - locale
  apt:
    # even set to no/false, geoip lookup still happens
    #geoip: no
    preserve_sources_list: false
    primary:
      - arches: [amd64, i386]
        uri: http://us.archive.ubuntu.com/ubuntu
      - arches: [default]
        uri: http://ports.ubuntu.com/ubuntu-ports
  identity:
    hostname: {{ hostname | default('ubuntu-server') }}
    password: "{{ password | default('$6$FhcddHFVZ7ABA4Gi$z2g1zrhdlUD9bEcT4KhGfvySJjfKE5ZEfGX5jj//t1ZQovRRssTDYrZMh69xnNs43Lp4yPsi6NaMDLZ9X1Xpj1') }}"
    username: {{ username | default('ubuntu') }}
  keyboard:
    layout: {{ keyboard_layout | default('us') }}
  locale: {{ locale | default('en_US.UTF-8') }}
  network:
    network:
      version: 2
      ethernets:
        {{ network_interface | default('enp1s0') }}:
          critical: true
          dhcp-identifier: mac
          dhcp4: true
        enp2s0:
          match:
            macaddress: 52:54:00:8c:8a:8c
          set-name: enp2s0
        enp3s0:
          match:
            macaddress: 52:54:00:ec:c2:c1
          set-name: enp3s0
      bonds:
        bond0:
          interfaces:
            - enp2s0   # First network interface MAC address
            - enp3s0  # Second network interface MAC address
          parameters:
            mode: 802.3ad  # LACP bonding mode
            mii-monitor-interval: 100
          dhcp4: true

  ssh:
    allow-pw: true
    authorized-keys:
      - {{ ssh_public_key | default('ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC4AfEs01eaTKUdG+92iy/fTCvABLHwlekBvWyQHYjZFv9CEBrNyyqeT7odmBHuAPxPIWqtCiL0/11SSd/4/eOUTblWnXI8U+peVcf8dnvuBTWLPa1/eh3Iuqaje0co8DlKow2oIYswOvmPYbs1o8VVGy4/lzjzkRf+37lMCopFD0vaP++k0ld5hl8HHF6NwVYyI/GzKY8Z2hEkAQd9y4aC7j8TDat04s2O5JvR4tgP1ydS8lyAirAZ3T6D1SB2sHb7HZ3nRteYbce13uFvNWI64OvJobpY/Y3BLb1VALYOJkR6l+6Lm4y5ipJiVETtPPjhgQYN9TWS3O+JJGEiOXFlHWq1H10e1/4OvJXNkzDp5L0MiFSpBe+mN2WAwjMlGBbtBpq06lPu7BG9hCVDkHL6EU/JQtgDrQhxxSlsgxXiJxJOvJJZIm7+I5WeCsCEUGPRTV/8eBf3K8WBaxhCTSfjAOLx3drQE/1O8/uvExaNrMkIhhVh0X7kivPBI7aP0E8= root@headnode01') }}
    install-server: true
  storage:
    config:
    - {ptable: gpt, path: /dev/vda, preserve: false, name: '', grub_device: false,
      type: disk, id: disk-sda}
    - {device: disk-sda, size: 536870912, wipe: superblock, flag: boot, number: 1,
      preserve: false, grub_device: true, type: partition, id: partition-sda1}
    - {fstype: fat32, volume: partition-sda1, preserve: false, type: format, id: format-2}
    - {device: disk-sda, size: 1073741824, wipe: superblock, flag: linux, number: 2,
      preserve: false, grub_device: false, type: partition, id: partition-sda2}
    - {fstype: ext4, volume: partition-sda2, preserve: false, type: format, id: format-0}
    - {device: disk-sda, size: -1, wipe: superblock, flag: linux, number: 3, preserve: false,
      grub_device: false, type: partition, id: partition-sda3}
    - {name: vg-0, devices: [partition-sda3], preserve: false, type: lvm_volgroup, id: lvm-volgroup-vg-0}
    - {name: lv-root, volgroup: lvm-volgroup-vg-0, size: 100%, preserve: false,
      type: lvm_partition, id: lvm-partition-lv-root}
    - {fstype: ext4, volume: lvm-partition-lv-root, preserve: false, type: format,
      id: format-1}
    - {device: format-1, path: /, type: mount, id: mount-2}
    - {device: format-0, path: /boot, type: mount, id: mount-1}
    - {device: format-2, path: /boot/efi, type: mount, id: mount-3}